---
title: "benchmark_iamp2l"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ampir)
```


```{r}
tg_train <- read_faa("data-raw/tmpdata/iamp2l/amp_train_iamp2l.fasta")

tg_train <- tg_train[!duplicated(tg_train$seq.aa),]

tg_train$Label <- "Tg"

bg_train <- read_faa("data-raw/tmpdata/iamp2l/nonamp_train_iamp2l.fasta")

bg_train$Label <- "Bg"

train_set <- rbind(bg_train, tg_train)


tg_test <- read_faa("data-raw/tmpdata/iamp2l/amp_tst_iamp2l.fasta")

tg_test$Label <- "Tg"

bg_test <- read_faa("data-raw/tmpdata/iamp2l/nonamp_tst_iamp2l.fasta")

bg_test <- read_faa("tmpdata/iamp2l/nonamp_tst_iamp2l.fasta")

bg_test <- bg_test[!duplicated(bg_test$seq.aa),]

bg_test$Label <- "Bg"

test_set <- rbind(bg_test, tg_test)


```


```{r}

train_set <- train_set[nchar(train_set$seq.aa) >=20,]

featurestrainiamp2l <- calculate_features(train_set)

featurestrainiamp2l$Label <- train_set$Label

featurestrainiamp2l[["Label"]] <- factor(featurestrainiamp2l[["Label"]])


test_set <- test_set[nchar(test_set$seq.aa) >=20,]

featurestestiamp2l <- calculate_features(test_set)

featurestestiamp2l$Label <- test_set$Label

featurestestiamp2l[["Label"]] <- factor(featurestestiamp2l[["Label"]])
```



```{r}


trctrl <- trainControl(method = "repeatedcv", number = 10, repeats = 3, classProbs = TRUE)


svm_iamp2ltgbg <- train(Label~., data = featurestrainiamp2l[,-c(1,27:45)], method="svmRadial",
                    trControl = trctrl, preProcess = c("center", "scale"),
                    tuneLength = 10)

```


```{r}
test_iamp2l_pred <- predict(svm_iamp2ltgbg, newdata = featurestestiamp2l)

confusionMatrix(test_iamp2l_pred, featurestestiamp2l$Label)

mcc(TP = 708, FP = 47, TN = 766, FN = 0)

library(pROC)

test_iamp2l_pred_prob <- predict(svm_iamp2ltgbg, featurestestiamp2l, type = "prob")
roc_out <- roc(featurestestiamp2l$Label, test_iamp2l_pred_prob$Tg)
```

```{r}
library(ampir)

featuresTest_1000 <- readRDS("tmpdata/1000_test_features.rds")

#test with 1000 sp proteins
test_iamp2l1000 <- predict(svm_iamp2ltgbg, newdata = featuresTest_1000)

confusionMatrix(test_iamp2l1000, featuresTest_1000$Label)

library(mltools)

mcc(TP = 204, FP = 297, TN = 498, FN = 1)

library(pROC)

test_pred_prob <- predict(svm_iamp2ltgbg, featuresTest_1000, type = "prob")
roc_out <- roc(featuresTest_1000$Label, test_pred_prob$Tg)
```

```{r}
iamp2l_results <- read.delim("tmpdata/iamp2l/iamp2l_1000_test_sqns.txt", header = FALSE)

iamp2l_results$Label = NA

iamp2l_results$Label[grep("non-AMP", iamp2l_results$V1)] = "Bg"

iamp2l_results$Label[which(is.na(iamp2l_results$Label)==T)] = "Tg"


iamp2l_results$Label <- as.factor(iamp2l_results$Label)

#predicted against reference (true results)
confusionMatrix(iamp2l_results$Label, featuresTest_1000$Label, mode = "everything")


mcc(TP = 234, FP = 267, TN = 492, FN = 7)


#no probability value from iamp-2l, cannot calculate AUC

```

```{r}#

library(stringr)

# SP

#str_extract(t, "[a-z]+\\|[A-Z0-9]+\\|[A-Z]+_[A-Z]+")
str_match(t, "\\(([a-z]+\\|[A-Z0-9]+\\|[A-Z]+_[A-Z]+)")

iamp_result_sp_names <- as.data.frame(str_match(iamp2l_results$V1, "\\(([a-z]+\\|[A-Z0-9]+\\|[A-Z]+_[A-Z]+)")[,2])
colnames(iamp_result_sp_names)[1] <- "Names"

#APD & LAMP

str_match(tt2, "\\(([A-Z0-9]+)")

iamp2l_results_apd_lamp_names <- as.data.frame(str_match(iamp2l_results$V1, "\\(([A-Z0-9]+)")[,2])
colnames(iamp2l_results_apd_lamp_names)[1] <- "Names"


tt <- cbind(iamp_result_sp_names, iamp2l_results_apd_lamp_names)

#random letters :( how to put together different names of several columns in same column. waaaaah)

grep("\\(([a-z]+\\|[A-Z0-9]+\\|[A-Z]+_[A-Z]+)", tt3)

grep("\\((sp+\\|[A-Z0-9]+\\|[A-Z]+_[A-Z]+)", t)
```



